
# Docker란 무엇인가?


기존 개발자들은 큰 불편함을 가지고 있었다.
- 새로운 컴퓨터에서는 개발 환경 세팅하느라 시간 낭비
- 업데이트 하면 뭔가 오류
- 코드 짠 걸 서버 컴퓨터로 옮기면 문제 발생

그러나 Docker와 container가 나온 후에 이러한 불편함이 사라짐
때문에 개발자들이 가장 많이 쓰는 툴 1위를 매년 Docker가 차지함
Docker란 '리눅스 컨테이너를 기반으로 만든 OS 레벨 가상화 기술'이라고 할 수 있음


예시로 치킨집을 차렸다. 잘 되어서 분점을 내게 되었음.
그럼 분점은 어떻게 내는가? 그냥 레시피를 전달해줘? 그럼 망하지 바부야.
제대로 장사하려면 쓰던 재료랑 레시피, 시설을 *** 밀키트 ***로 만들고
이를 전달하는 식으로 운영하면 되겠지?
개발도 똑같지, 팀원끼리 협업하거나 AWS에 있는 서버 컴퓨터에다가 내 코드를 배포할 때
같은 코드를 각각 다른 컴퓨터에서 실행해야 할 때가 생긴다. 그러나 컴퓨터마다 OS도 다르고 설치된 기본프로그램들 버전도 달라서 당연히 문제가 생기지.
옛날같은 경우 VM이라는 걸 사용했는데, 어떤 OS 위에 다른 OS를 설치하는 건데, 굉장히 무겁고 성능도 좋지 않기에 훨씬 가벼운 Docker와 컨테이너를 사용하는 것임

## Docker

'코드 밀키트'
- 필요한 프로그램, 실행할 코드
- 개발용 SDK, 라이브러리
- OS

코드 밀키트를 만들고, 코드 밀키를 실행하는 간단한 프로그램이 Docker이다.

*** 일단 어떻게 진행되는 것인가? ***
1. Dockerfile 이라는 파일을 하나 만들고 '무슨 OS와 어떤 프로그램이랑 라이브러리, SDK를 설치하고, 어떤 코드를 어떻게 실행할 것'인지 정의하는 것.
2. 'docker build' 라는 명령어를 입력하면 밀키트로 포장이 되고, 'docker run' 명령어를 입력하면, 해당 밀키트를 실행
3. 밀키트를 실행하면 컨테이너라고 부르는 가상 컴퓨터가 하나 만들어지고, 그 안에서 설정해둔 OS와 작업환경에서 코드가 실행된다


*** Docker가 변화시킨 개발 업계 ***
1. MSA(Micro Service Architecture) 생성 : 서버기능을 하나의 프로그램 안에 쑤셔넣었던 옛날과 다르게, 지금은 잘게 쪼개서 여러 프로그램으로 나누고 그걸 따로따로 배포해서 운영 중이다. 이러면 여러명이 분업하기도 좋고, 기능 업데이트도 빨라진다는 장점이 있다.
2. 프로그램을 빌드하고 테스트, 배포하는 작업이 쉬워졌기 때문에, 원클릭 딸깍 자동 배포같은 걸 도입하기 시작하는 곳 증가
3. Docker 쓰면 원하는 프로그램을 원하는 버전으로 원하는 OS 위에 쉽게 설치하고 깔끔하게 삭제할 수 있어서, 내가 만든 프로그램을 이거저거 버전별로 테스트해보기도 쉬워졌고, 내 컴퓨터에 뭐 설치하기 싫어하는 결벽증 환자도 증가하고, 덕분에 강의나 책 만드는 것도 쉬워짐


*** Docker 실체 ***
리눅스 자체에는 원래 가벼운 가상화기술같은 게 있었다.
가상 파일시스템을 만들어주는 union filesystem, namespace
원하는 곳에 컴퓨터 자원을 할당해주는 cgroups라는 기능을 쓰면 리눅스 컴퓨터 안에 가상 컴퓨터를 만들 수 있다. 그걸 쓸 수 있게 도와주는 프로그램도 누가 만들어둔 게 있다. (runc, containerd 같은 거) 이런 것들을 짜집기헤사 만들어둔 것이 Docker라는 프로그램이다. 여기에 push나 모니터링 등 편의기능도 추가되었음.

그래서 Docker 대신 쓸 수 있는 프로그램도 있고(podman, cri-o), Docker 없이 직접 컨테이너(가상 컴퓨터)를 띄우는 것도 가능하다.


*** 단점 ***
1. 컨테이너 침입과 같은 새로운 보안이슈 챙겨야함
2. 컨테이너를 많이 사용하면 관리 시간과 서버비용이 증가
3. 안정적인 DB같은 거 띄울 땐 컨테이너로 만드는 게 딱히 이점이 없음
4. 컨테이너 간 완벽한 격리를 원하면 가벼운 VM을 스는 게 나을 수 있음


Docker 세팅으로 다른 코딩을 공부하는 것이 이점이 있는 것은 아님.
나만의 요리를 만들어보는 (직접 설치하고 세팅하고 노가다하는 ..) 연습도 필요함.
그래야 나중에 Dockerfile도 맘대로 작성할 수 있게 된다.

혼자 알아서 잘할 수 있는 방법을 주로 이해하고,
실제 웹서버를 만드는 상황에서 Docker를 사용할 예정


- - -


# Docker 설치 및 이미지와 컨테이너 개념

터미널 명령어로 docker 조작하는 것도 가능하지만
공식 GUI 프로그램을 쓰면 그걸로 훨씬 편하게 docker 기능들을 사용할 수 있다. 구글에서 'docker desktop'을 검색해서 설치한다. docker 엔진, docker compose, docker CLI 등 필요한 걸 모두 설치

- 윈도우는 아마 대부분 AMD64(일명 x86-64) 이거 설치하면 될 것이고, ARM 어쩌구 CPU를 쓰는 경우에 ARM을 선택 (아마 재시작 필요)
- 맥북은 CPU가 M1 이상인 분들은 apple silicon 선택


### 용어 정리

- 이미지 : 밀키트라고 비유해서 설명한 걸 '이미지'라고 한다. 이미지에는 os, 실행에 필요한 프로그램, 라이브러리, 소스코드 등이 들어있다. 이미지를 사용하면 환경 맞추기도 쉽고, 내 프로그램을 다른 곳에서 실행하기도 쉬움. 예를 들어 서버 컴퓨터에 배포하고자 할 때, Docker를 쓰면 '내 작업환경이랑 코드를 그대로 이미지로 만든' 후에 '이미지를 그 서버컴퓨터로 옮겨서 실행만 눌러두면 된다' 이때 ***태그***는 버전이랑 비슷한 말이다.

docker desktop 하단에 터미널 오픈하는 버튼이 있다.

<pre>
<code>
    이미지 다운로드
    docker pull 이미지이름::태그명 

    이미지 목록 확인
    docker image ls

    이미지 실행
    docker run 이미지이름:태그명 
</code>
</pre>

- 컨테이너 : 이미지를 실행중인 가상 컴퓨터


- - -


# 서버 만들기 실습

"접속하면 특정한 것을 보내주는 것이 서버"

Node.js로 시작해 보자.
1. Node.js 설치
2. Express 라이브러리 설치
3. 코드 짜기
4. 코드 실행

이걸 잘 기억해야 앞으로 도커도 잘 사용할 수 있다.
밀키트 만들 때 이 작업 그대로 하라고 도케에게 명령해야 하는 것


<pre>
<code>
    어떤 라이브러리 어떤 것을 설치했는지 기록할 수 있는 파일을 하나 생성 가능
    npm init -y

    npm install express

    npm server.js
</code>
</pre>



암튼 이렇게 서버 하나 만들어서 배포하고 싶으면 어떻게 함?
AWS 이런 곳에서 서버컴퓨터 빌려서 방금했던 4-step 그대로 똑같이 하면 서버배포 끝
그 후에 '해당컴퓨터IP4주소:포트번호'로 들어가면 해당 서버로 접속 가능
이건 단점이 있지? 1. 귀찮고, 2. 컴퓨터마다 환경이 달라서 의도대로 동작하지 않을 수 있음

Docker를 사용하면 내 환경과 코드를 이미지로 만들 수 있다고 했죠? 이미지는 옮기기도 쉽고 실행도 쉽기 때문에 1. 내 환경과 코드를 이미지로 만든 후에 2. AWS 컴퓨터에 그대로 이미지를 옮겨서 실행만 하는 것이 훨씬 간단하고 에러도 적다


## 이미지는 어떻게 만드는가?
Dockerfile이 필요하다. '어떤 OS를 설치해야 하는지, 어떤 프로그램과 라이브러리를 설치할건지 어떤 터미널 명령어를 실행할 건지 다 적어놓을 수 있다' 이후 docker build 명령어 입력하면 나만의 이미지를 하나 만들 수 있는 것.
